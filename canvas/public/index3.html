<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Node Kinect2 Client</title>
    <style>
        body,
        html {
            padding: 0;
            margin: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #bodyCanvas, #bodyCanvas2 {
            position: absolute;
            z-index: 1000;
            left: 0;
            top: 0;
        }

    

        .cb-slideshow,
        .cb-slideshow:after {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            z-index: 0;
            list-style: none;
        }
        .cb-slideshow:after {
            content: '';
            background: transparent url(../images/pattern.png) repeat top left;
        }
        .cb-slideshow li span {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0px;
            left: 0px;
            color: transparent;
            background-size: cover;
            background-position: 50% 50%;
            background-repeat: none;
            opacity: 0;
            z-index: 0;
            backface-visibility: hidden;
            animation: imageAnimation 90s linear infinite 0s;
        }
        .cb-slideshow li div {
            z-index: 1000;
            position: absolute;
            bottom: 30px;
            left: 0px;
            width: 100%;
            text-align: center;
            opacity: 0;
            animation: titleAnimation 90s linear infinite 0s;
        }
        .cb-slideshow li div h3 {
            font-family: 'Times New Roman', Times, serif;
            font-size: 90px;
            padding: 0;
            line-height: 90px;
            color: #de0033;
            text-shadow: #FC0 1px 0 10px;
        }
        .cb-slideshow li:nth-child(1) span { background-image: url('./images/rome1.jpg') }
        .cb-slideshow li:nth-child(2) span {
            background-image: url('./images/rome2.jpg');
            animation-delay: 6s;
        }
        .cb-slideshow li:nth-child(3) span {
            background-image: url('./images/rome3.jpg');
            animation-delay: 12s;
        }
        .cb-slideshow li:nth-child(4) span {
            background-image: url('./images/rome4.jpg');
            animation-delay: 18s;
        }
        .cb-slideshow li:nth-child(5) span {
            background-image: url('./images/rome5.jpg');
            animation-delay: 24s;
        }
        .cb-slideshow li:nth-child(6) span {
            background-image: url('./images/rome6.jpg');
            animation-delay: 30s;
        }
        .cb-slideshow li:nth-child(7) span {
            background-image: url('./images/rome7.jpg');
            animation-delay: 36s;
        }
        .cb-slideshow li:nth-child(8) span {
            background-image: url('./images/rome8.jpg');
            animation-delay: 42s;
        }
        .cb-slideshow li:nth-child(9) span {
            background-image: url('./images/rome9.jpg');
            animation-delay: 48s;
        }
        .cb-slideshow li:nth-child(10) span {
            background-image: url('./images/rome10.jpg');
            animation-delay: 54s;
        }
        .cb-slideshow li:nth-child(11) span {
            background-image: url('./images/rome11.jpg');
            animation-delay: 60s;
        }
        .cb-slideshow li:nth-child(12) span {
            background-image: url('./images/rome12.jpg');
            animation-delay: 66s;
        }
        .cb-slideshow li:nth-child(13) span {
            background-image: url('./images/rome13.jpg');
            animation-delay: 72s;
        }
        .cb-slideshow li:nth-child(14) span {
            background-image: url('./images/rome14.jpg');
            animation-delay: 78s;
        }
        .cb-slideshow li:nth-child(15) span {
            background-image: url('./images/rome15.jpg');
            animation-delay: 84s;
        }

        .cb-slideshow li:nth-child(2) div {
            animation-delay: 6s;
        }
        .cb-slideshow li:nth-child(3) div {
            animation-delay: 12s;
        }
        .cb-slideshow li:nth-child(4) div {
            animation-delay: 18s;
        }
        .cb-slideshow li:nth-child(5) div {
            animation-delay: 24s;
        }
        .cb-slideshow li:nth-child(6) div {
            animation-delay: 30s;
        }
        .cb-slideshow li:nth-child(7) div {
            animation-delay: 36s;
        }
        .cb-slideshow li:nth-child(8) div {
            animation-delay: 42s;
        }
        .cb-slideshow li:nth-child(9) div {
            animation-delay: 48s;
        }
        .cb-slideshow li:nth-child(10) div {
            animation-delay: 54s;
        }
        .cb-slideshow li:nth-child(11) div {
            animation-delay: 60s;
        }
        .cb-slideshow li:nth-child(12) div {
            animation-delay: 66s;
        }
        .cb-slideshow li:nth-child(13) div {
            animation-delay: 72s;
        }
        .cb-slideshow li:nth-child(14) div {
            animation-delay: 78s;
        }
        .cb-slideshow li:nth-child(15) div {
            animation-delay: 84s;
        }
        /* Animation for the slideshow images */
        @keyframes imageAnimation { 
            0% {
                opacity: 0;
                animation-timing-function: ease-in;
            }
            3% {
                opacity: 1;
                transform: scale(1.05);
                animation-timing-function: ease-out;
            }
            6% {
                opacity: 1;
                transform: scale(1.1);
            }
            12% {
                opacity: 0;
                transform: scale(1.2);
            }
            100% { opacity: 0 }
        }
        /* Animation for the title */
        @keyframes titleAnimation { 
            0% {
                opacity: 0;
                transform: translateY(100px);
            }
            2% {
                opacity: 1;
                transform: translateY(0px);
            }
            5% {
                opacity: 1;
                transform: scale(1);
            }
            8% { opacity: 0 }
            10% {
                opacity: 0;
                transform: scale(10);
            }
            100% { opacity: 0 }
        }
        /* Show at least something when animations not supported */
        .no-cssanimations .cb-slideshow li span{
            opacity: 1;
        }
        @media screen and (max-width: 1140px) { 
            .cb-slideshow li div h3 { font-size: 100px }
        }
        @media screen and (max-width: 600px) { 
            .cb-slideshow li div h3 { font-size: 50px }
        }

        #maintext {
            font-weight: 900;
            font-family: 'Times New Roman', Times, serif;
            position: absolute;
            top: 2rem;
            right: 2rem;
            font-size: 5rem;
            color: #e8b923;
            text-shadow: 1px 1px 10px #000;
            text-align: right; 
            z-index: 3000;
        }

    </style>
</head>

<body id="wrap">

    <ul class="cb-slideshow">
        <li><span>Image 01</span><div><h3>For our struggle is not against</h3></div></li>
        <li><span>Image 02</span><div><h3>flesh and blood</h3></div></li>
        <li><span>Image 03</span><div><h3>but against the rulers</h3></div></li>
        <li><span>Image 04</span><div><h3>against the authorities</h3></div></li>
        <li><span>Image 05</span><div><h3>against the powers of this dark world </h3></div></li>
        <li><span>Image 06</span><div><h3>against the spiritual forces</h3></div></li>
        <li><span>Image 07</span><div><h3>of evil in the heavenly realms</h3></div></li>
        <li><span>Image 08</span><div><h3>Therefore put on the full armor of God</h3></div></li>
        <li><span>Image 09</span><div><h3>gospel·of·peace</h3></div></li>
        <li><span>Image 10</span><div><h3>helmet·of·salvation</h3></div></li>
        <li><span>Image 11</span><div><h3>belt·of·truth</h3></div></li>
        <li><span>Image 12</span><div><h3>sword·of·the·Spirit</h3></div></li>
        <li><span>Image 13</span><div><h3>breastplate·of·righteousness</h3></div></li>
        <li><span>Image 14</span><div><h3>shield·of·faith</h3></div></li>
        <li><span>Image 15</span><div><h3>stand your ground</h3></div></li>
    </ul>
    <div id="maintext">VICTORIOSO</div>

    <canvas id="bodyCanvas" text="victorioso" size="228"></canvas>
    <canvas id="bodyCanvas2"></canvas>

    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        const socket = io.connect('/')

        const canvas2 = document.getElementById('bodyCanvas2')
        canvas2.width = window.innerWidth
        canvas2.height = window.innerHeight
        const ctx2 = canvas2.getContext("2d")

        const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#00ffff', '#ff00ff']

        const c = document.getElementById("bodyCanvas")
        const $ = c.getContext("2d")
        const w = c.width = window.innerWidth
        const h = c.height = window.innerHeight

        let lite = (function () {
            function lite(x, y) {
                this.x = x
                this.y = y
            }

            lite.prototype.upd = function () {
                this.x -= Math.sin(Math.random()) * 6 - 3
                this.y -= Math.cos(Math.random()) * 6 - 3
            }
            return lite
        })()

        let strikes = []
        colors.forEach( (c, i) => {
            strikes[i] = [new lite(w / 2, h / 2)]
        })
        let index = 0

        // handstate circle size
        const HANDSIZE = 20

        $.clearRect(0, 0, w, h)
        ctx2.clearRect(0, 0, w, h)

        function drawHand(jointPoint, handColor) {
            // draw semi transparent hand cicles
            ctx2.beginPath()
            ctx2.fillStyle = '#ffffff'
            ctx2.shadowColor = handColor
            ctx2.shadowBlur = HANDSIZE
            ctx2.shadowOffsetX = 0
            ctx2.shadowOffsetY = 0
            ctx2.arc(jointPoint.x, jointPoint.y, HANDSIZE, 0, Math.PI * 2, true)
            ctx2.fill()
            ctx2.closePath()
            ctx2.globalAlpha = 1
        }

        socket.on('bodyFrame', function (bodyFrame) {
            ctx2.clearRect(0, 0, w, h)

            index = 0
            mouse = []
            bodyFrame.bodies.forEach(function (body) {
                if (body.tracked) {
                    /*for (var jointType in body.joints) {
                    	
                        ctx.fillStyle = colors[index]
                        ctx.fillRect(joint.depthX * canvas.width, joint.depthY * canvas.height, 10, 10)
                    }*/
                    //draw hand states
                    //updateHandState(body.leftHandState, body.joints[7])
                    //updateHandState(body.rightHandState, body.joints[11])
                    /*cameraX: -0.35769253969192505
cameraY: -0.07199238240718842
cameraZ: 0.6234135627746582
colorX: 0.23137125372886658
colorY: 0.6159010529518127
depthX: 0.09679907560348511
depthY: 0.5932852029800415
jointType: 11
orientationW: 0.6392228007316589
orientationX: 0.45933452248573303
orientationY: 0.5539015531539917
orientationZ: 0.27129146456718445
trackingState: 2*/

                    let joint = body.joints[11]
                    const cords = { x: joint.depthX * w, y: joint.depthY * h }
                    drawHand(cords, colors[index])
                    strikes[index].push(new lite(cords.x, cords.y))
                    index++
                }
            })

            window.requestAnimationFrame(draw)
        })


        function rnd(min, max) {
            return Math.random() * (max - min) + min
        }

        function draw() {
            $.clearRect(0, 0, w, h)
            $.globalCompositeOperation = 'source-over'
            if (index > 0) {
                for (let strikeIndex = 0; strikeIndex < index; strikeIndex++) {
                    $.fillStyle = colors[index]
                    $.lineWidth = rnd(1, 5)
                    $.lineCap = 'round'
                    $.strokeStyle = 'hsla(195, 95%, 95%, 1)'
                    $.globalCompositeOperation = 'lighter'
                    $.beginPath()
                    $.moveTo(strikes[strikeIndex][0].x, strikes[strikeIndex][0].y)
                    strikes[strikeIndex].forEach((itm, idx) => {
                        itm.upd()

                        idx = idx + (Math.floor(Math.random()) * 6 - 3)
                        if (0 <= idx && idx < strikes[strikeIndex].length) {
                            let o = strikes[strikeIndex][idx]
                            $.lineTo(o.x, o.y)
                        }
                    })
                    $.stroke()
                    if (strikes[strikeIndex].length > 50) {
                        strikes[strikeIndex].splice(0, 1)
                    }
                }
            }

        }

    </script>
</body>

</html>